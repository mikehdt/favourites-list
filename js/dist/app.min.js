var app=app||{};!function(e,t,i){"use strict";app.PropertyModel=t.Model.extend({defaults:{list:"",id:"-1",agency:{},price:"No price set",mainImage:"",saved:!1},initialize:function(e){7!==e.agency.brandingColors.primary.length&&(console.warn&&console.warn("Property ID",e.id,"has an invalid primary hex colour ("+e.agency.brandingColors.primary+")"),e.agency.brandingColors.primary="#ffffff"),this.collection&&this.collection.getCollectionType&&this.set("list",this.collection.getCollectionType())},setSaved:function(){this.set("saved",!0)},removeSaved:function(){this.set("saved",!1)}})}(jQuery,Backbone,_);var app=app||{};!function(e,t,i){"use strict";var s=t.Collection.extend({model:app.PropertyModel,getCollectionType:function(){return"results"}});app.resultsCollection=new s}(jQuery,Backbone,_);var app=app||{};!function(e,t,i){"use strict";var s=t.Collection.extend({model:app.PropertyModel,getCollectionType:function(){return"saved"}});app.savedCollection=new s}(jQuery,Backbone,_);var app=app||{};!function(e,t,i){"use strict";app.AppView=t.View.extend({el:".properties",noSavedTemplate:i.template(e("#tpl__no-saved").html()),initialize:function(){this.$properties__list=this.$(".properties__list"),this.$properties__saved=this.$(".properties__saved"),this.listenTo(app.resultsCollection,"add",this.addOneResult),this.listenTo(app.savedCollection,"add",this.addOneSaved),this.listenTo(app.resultsCollection,"reset",this.addAllResult),this.listenTo(app.savedCollection,"reset",this.addAllSaved),this.listenTo(app.listingsCollection,"all",i.debounce(this.render,0)),this.initCollection()},initCollection:function(){e.ajax({type:"GET",cache:!1,url:"./json/listings.json",success:e.proxy(this.initCollectionSuccess,this),error:e.proxy(this.initCollectionFail,this)})},initCollectionSuccess:function(e){e.results&&app.resultsCollection.reset(e.results),e.saved&&app.savedCollection.reset(e.saved)},initCollectionFail:function(e,t,i){return console.error&&console.group&&console.log&&(console.error("AJAX request failed"),console.group("Request details"),console.log("Status:",JSON.stringify(t)),console.log("Error:",JSON.stringify(i)),console.log(JSON.stringify(e)),console.groupEnd()),!1},addOneResult:function(e){e.trigger("parse");var t=new app.PropertyView({model:e});this.$properties__list.append(t.render().el),this.listenTo(t,"saved:add",this.addSaved),this.listenTo(t,"saved:remove",this.removeSaved)},addOneSaved:function(e){e.trigger("parse");var t=new app.PropertyView({model:e});this.$properties__saved.append(t.render().el),this.listenTo(t,"saved:add",this.addSaved),this.listenTo(t,"saved:remove",this.removeSaved),t.$el.addClass("property--added"),setTimeout(function(){t.$el.removeClass("property--added")},0)},addAllResult:function(){this.$properties__list.html(""),app.resultsCollection.each(this.addOneResult,this)},addAllSaved:function(){this.$properties__saved.html(""),app.savedCollection.each(this.addOneSaved,this)},addSaved:function(e){if(0===app.savedCollection.length&&this.$properties__saved.html(""),app.savedCollection.contains(e))console.log("Already added: ID",e.get("id"));else{e.setSaved();var t=e.clone();t.set("list",app.savedCollection.getCollectionType()),app.savedCollection.add(t)}},removeSaved:function(t,i){this.stopListening(i);var s=app.resultsCollection.findWhere({id:t.get("id")});s&&s.removeSaved(),app.savedCollection.length-1<1&&(this.$properties__saved.append(this.noSavedTemplate),this.$properties__saved.addClass("properties__saved--added"),setTimeout(e.proxy(function(){this.$properties__saved.removeClass("properties__saved--added")},this),0))}})}(jQuery,Backbone,_);var app=app||{};!function(e,t,i){"use strict";app.PropertyView=t.View.extend({tagName:"li",className:"property",events:{"click .property__item":"handleClick"},template:i.template(e("#tpl__property").html()),initialize:function(e){this.options=i.extend({},this,e||{}),this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove)},render:function(){return this.$el.html(this.template(this.model.toJSON())),this},handleClick:function(e){e.preventDefault();var t=this.model.get("id"),i=this.model.get("list");this.$el.blur(),"results"===i?this.trigger("saved:add",this.model):"saved"===i&&(this.trigger("saved:remove",this.model,this),app.savedCollection.remove([t]),this.stopListening(),this.remove())}})}(jQuery,Backbone,_);var app=app||{};$(function(){"use strict";FastClick.attach(document.body),new app.AppView});
//# sourceMappingURL=app.min.js.map